<!DOCTYPE html>
<html lang="es">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>VAULT</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }

        header {
            text-align: center;
            padding: 20px;
            background-color: #4a90e2;
            color: white;
            font-size: 1.5em;
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .filters label {
            display: flex;
            flex-direction: column;
            font-size: 0.9em;
            color: #333;
        }

        .filters select,
        .filters input {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .filters button {
            padding: 10px 20px;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }

        .filters button:hover {
            background-color: #357ab8;
        }

        .card-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            padding: 20px;
        }

        .card {
            overflow: hidden;
            text-align: center;
            width: 140px;
            height: 200px;
            transition: transform 0.2s ease-in-out;
        }

        .card:hover {
            transform: scale(1.1);
        }

        .card img {
            width: 100%;
            height: 100%;
            border-radius: 5px;
        }

        .card p {
            margin: 10px 0;
            font-size: 0.9em;
            color: #333;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            cursor: pointer;
            font-size: 20px;
            color: #333;
        }

        .close-modal:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
                align-items: center;
                gap: 50px;
                padding: 10px;
            }

            .filters label {
                width: 100%;
                text-align: left;
            }

            .filters select,
            .filters input {
                width: 100%;
            }

            .card {
                width: 80px;
                height: 110px;

            }

            .modal-content {
                width: 90%;
            }            

            .card-list {
                gap: 5px;
                padding: 5px;
            }
        }
    </style>
</head>

<body>
    <label>Set:
        <select id="filter-set">
            <option value="">Selecciona un set</option>
        </select>
    </label>
    <label>Nombre: <input type="text" id="filter-name"></label>
    <label>Color:
        <select id="filter-color">
            <option value="">Todos</option>
            <option value="Amber">Ámbar</option>
            <option value="Amethyst">Amatista</option>
            <option value="Emerald">Esmeralda</option>
            <option value="Ruby">Rubi</option>
            <option value="Sapphire">Zafiro</option>
            <option value="Steel">Acero</option>
        </select>
    </label>
    <label>Rareza:
        <select id="filter-rarity">
            <option value="">Todas</option>
            <option value="Common">Comun</option>
            <option value="Uncommon">No comun</option>
            <option value="Rare">Rara</option>
            <option value="Super_rare">Super Rara</option>
            <option value="Legendary">Legendaria</option>
            <option value="Enchanted">Encantada</option>
            <option value="Iconic">Iconica</option>
            <option value="Promo">Promo</option>
        </select>
    </label>
    <label>Tipo:
        <select id="filter-type">
            <option value="">Todos</option>
            <option value="Character">Personaje</option>
            <option value="Item">Item</option>
            <option value="Action">Accion</option>
            <option value="Song">Cancion</option>
        </select>
    </label>
    <button id="apply-filters">Buscar</button>
    <div id="cards" class="card-list">Usa los filtros para buscar cartas.</div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content" id="modal-content">
            <span class="close-modal" id="close-modal">&times;</span>
            <div id="modal-body">Cargando...</div>
        </div>
    </div>

    <script>
        // Cargar los sets disponibles
        async function loadSets() {
            const setSelect = document.getElementById('filter-set');
            try {
                const response = await fetch('https://api.lorcast.com/v0/sets');
                const sets = await response.json(); // La respuesta tiene una propiedad `results`
                console.log(sets); // Inspecciona la estructura de la respuesta

                // Añadir la opción "Todos"
                const allOption = document.createElement('option');
                allOption.value = 'all'; // Valor especial para "Todos"
                allOption.textContent = 'Todos los sets';
                setSelect.appendChild(allOption);

                // Accede a `results` para obtener el array de sets
                sets.results.forEach(set => {
                    const option = document.createElement('option');
                    option.value = set.id; // ID del set
                    option.textContent = `${set.name} (${set.code})`; // Nombre y código del set
                    setSelect.appendChild(option);
                });
            } catch (e) {
                console.error('Error al cargar los sets:', e.message);
            }
        }

        // Obtener las cartas de un set específico
        async function fetchCardsBySet() {
            const container = document.getElementById('cards');
            const setId = document.getElementById('filter-set').value;

            container.innerHTML = 'Cargando...';

            // Obtener los valores de los filtros
            const name = document.getElementById('filter-name').value.trim().toLowerCase();
            const color = document.getElementById('filter-color').value;
            const rarity = document.getElementById('filter-rarity').value;
            const type = document.getElementById('filter-type').value;

            try {
                let cards = [];

                if (setId === 'all') {
                    // Si se selecciona "Todos", obtener las cartas de todos los sets
                    const response = await fetch('https://api.lorcast.com/v0/sets');
                    const sets = await response.json();
                    for (const set of sets.results) {
                        const setResponse = await fetch(`https://api.lorcast.com/v0/sets/${set.id}/cards`);
                        const setCards = await setResponse.json();
                        cards = cards.concat(setCards); // Combinar las cartas de todos los sets
                    }
                } else {
                    // Obtener las cartas de un set específico
                    const response = await fetch(`https://api.lorcast.com/v0/sets/${setId}/cards`);
                    cards = await response.json();
                }

                // Filtrar las cartas según los valores seleccionados
                const filteredCards = cards.filter(card => {
                    return (!name || card.name.toLowerCase().includes(name)) &&
                        (!color || card.ink === color) &&
                        (!rarity || card.rarity === rarity) &&
                        (!type || card.type.includes(type));
                });

                // Mostrar las cartas
                container.innerHTML = '';
                if (filteredCards.length === 0) {
                    container.innerHTML = 'No se encontraron cartas con los filtros seleccionados.';
                    return;
                }

                filteredCards.forEach(card => {
                    const div = document.createElement('div');
                    div.className = 'card';

                    // Verificar la disponibilidad de las imágenes
                    const imageUri = card.image_uris.digital.normal ||
                        card.image_uris.digital.large ||
                        card.image_uris.digital.small ||
                        'https://via.placeholder.com/150'; // Imagen predeterminada

                    const img = document.createElement('img');
                    img.src = imageUri;
                    img.alt = card.name;
                    img.style.cursor = 'pointer';
                    img.addEventListener('click', () => showCardModal(card));
                    div.appendChild(img);
                    container.appendChild(div);
                });
            } catch (e) {
                container.innerHTML = `Error al cargar las cartas: ${e.message}`;
            }
        }

        // Mostrar detalles de una carta en el modal
        async function showCardModal(card) {
            const modal = document.getElementById('modal');
            const modalBody = document.getElementById('modal-body');
            modal.style.display = 'flex';

            // Manejar el caso en que `type` sea null o no esté definido
            const type = card.type ? card.type.join(', ') : 'Sin tipo';

            // Verificar la disponibilidad de las imágenes
            const imageUri = card.image_uris.digital.large ||
                card.image_uris.digital.normal ||
                card.image_uris.digital.small ||
                'https://via.placeholder.com/400'; // Imagen predeterminada

            modalBody.innerHTML = `
        <img src="${imageUri}" alt="${card.name}" style="max-width:100%"><br>
        <strong>${card.name} - ${card.version}</strong><br>
        <em>${type} - ${card.ink || 'Sin color'} - ${card.rarity || 'Sin rareza'}</em><br>
        <b>Coste:</b> ${card.cost || 'N/A'} | <b>Fuerza:</b> ${card.strength || 'N/A'} | <b>Voluntad:</b> ${card.willpower || 'N/A'}<br>
        <b>Set:</b> ${card.set.name || 'Sin set'} (${card.set.code || 'N/A'})<br>
        <b>Artista:</b> ${card.illustrators ? card.illustrators.join(', ') : 'Sin artista'}<br>
        <b>Clasificación:</b> ${card.classifications ? card.classifications.join(', ') : 'Sin clasificación'}<br>
        <b>Texto:</b> ${card.text || 'Sin texto'}<br>
        <i>${card.flavor_text || 'Sin texto de ambientación'}</i>
    `;
        }

        // Cerrar modal
        document.getElementById('close-modal').onclick = function () {
            document.getElementById('modal').style.display = 'none';
        };
        window.onclick = function (event) {
            if (event.target == document.getElementById('modal')) {
                document.getElementById('modal').style.display = 'none';
            }
        };

        // Evento para buscar cartas
        document.getElementById('apply-filters').onclick = function () {
            fetchCardsBySet();
        };

        // Cargar los sets al inicio
        loadSets();
    </script>
</body>

</html>